<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABU Health Analyzer Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .api-setup {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 30px;
        }

        .api-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 14px;
        }

        .upload-area {
            border: 3px dashed #ddd;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            margin: 20px 30px;
            transition: all 0.3s;
        }

        .upload-area:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .preview-image {
            max-width: 400px;
            max-height: 400px;
            border-radius: 15px;
            margin: 20px auto;
            display: none;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .analyze-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 18px 50px;
            border-radius: 50px;
            font-size: 1.2em;
            cursor: pointer;
            margin: 20px auto;
            display: block;
            transition: all 0.3s;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .analyze-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .status {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 30px;
            text-align: center;
            font-weight: bold;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }

        .results {
            display: none;
            margin: 30px;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .analysis-section {
            background: #f8f9ff;
            border-left: 4px solid #667eea;
            padding: 25px;
            margin: 20px 0;
            border-radius: 10px;
        }

        .analysis-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .zone-analysis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .zone-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
        }

        .zone-card h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .recommendation {
            background: white;
            border: 2px solid #667eea;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            transition: all 0.3s;
        }

        .recommendation:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.15);
        }

        .product-name {
            color: #667eea;
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .product-details {
            background: #f0f4ff;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî¨ ABU Health Analyzer Pro</h1>
            <p>–ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Claude API</p>
        </div>

        <div class="api-setup">
            <h4>ü§ñ Claude API - –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</h4>
            <input type="password" id="apiKey" class="api-input" placeholder="sk-ant-api03-..." value="">
            <p><small>
            üîë API –∫–ª—é—á: <a href="https://console.anthropic.com/" target="_blank">console.anthropic.com</a><br>
            üöÄ –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ Claude API (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö)
            </small></p>
        </div>

        <div id="status" class="status info">
            –í–≤–µ–¥–∏—Ç–µ Claude API –∫–ª—é—á –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ —è–∑—ã–∫–∞
        </div>

        <div class="upload-area" onclick="document.getElementById('fileInput').click()">
            <div style="font-size: 3em; color: #ddd; margin-bottom: 10px;">üì∑</div>
            <h3>–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ñ–æ—Ç–æ —è–∑–∏–∫–∞</h3>
            <p>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –¥–ª—è –≤–∏–±–æ—Ä—É –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è (JPG, PNG)</p>
            <input type="file" id="fileInput" style="display: none;" accept="image/*">
        </div>

        <img id="previewImage" class="preview-image">
        
        <button id="analyzeBtn" class="analyze-btn" disabled onclick="analyzeImage()">
            ü§ñ –ê–Ω–∞–ª—ñ–∑ Claude
        </button>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <h3>ü§ñ Claude –∞–Ω–∞–ª—ñ–∑—É—î —Ñ–æ—Ç–æ...</h3>
            <p>–ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤ –ø—Ä–æ—Ü–µ—Å—ñ</p>
        </div>

        <div id="results" class="results">
            <div class="analysis-section">
                <h3>üîç –î–µ—Ç–∞–ª—å–Ω–∏–π –≤—ñ–∑—É–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑</h3>
                <div id="detailedAnalysis"></div>
            </div>

            <div class="analysis-section">
                <h3>üó∫Ô∏è –ó–æ–Ω–∞–ª—å–Ω–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h3>
                <div id="zoneAnalysis" class="zone-analysis"></div>
            </div>

            <div class="analysis-section">
                <h3>üéØ –Ü–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—è –∑–¥–æ—Ä–æ–≤'—è</h3>
                <div id="healthInterpretation"></div>
            </div>

            <div class="analysis-section">
                <h3>üíä –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó ABU</h3>
                <div id="recommendations"></div>
            </div>

            <div class="analysis-section">
                <h3>üìà –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–≥—Ä–µ—Å—É</h3>
                <div id="monitoring"></div>
            </div>
        </div>
    </div>

    <script>
        let selectedFile = null;
        let apiKey = '';

        document.getElementById('apiKey').addEventListener('input', function(e) {
            apiKey = e.target.value.trim();
            updateStatus();
        });

        document.getElementById('fileInput').addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                selectedFile = e.target.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.getElementById('previewImage');
                    img.src = e.target.result;
                    img.style.display = 'block';
                    updateStatus();
                };
                reader.readAsDataURL(selectedFile);
            }
        });

        function updateStatus() {
            const statusDiv = document.getElementById('status');
            const analyzeBtn = document.getElementById('analyzeBtn');
            
            if (!apiKey) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå –í–≤–µ–¥–∏—Ç–µ Claude API –∫–ª—é—á';
                analyzeBtn.disabled = true;
            } else if (!selectedFile) {
                statusDiv.className = 'status info';
                statusDiv.textContent = 'üì∑ –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ —è–∑—ã–∫–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞';
                analyzeBtn.disabled = true;
            } else {
                statusDiv.className = 'status success';
                statusDiv.textContent = '‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∞–Ω–∞–ª–∏–∑—É!';
                analyzeBtn.disabled = false;
            }
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        async function analyzeImage() {
            if (!selectedFile || !apiKey) return;
            
            const btn = document.getElementById('analyzeBtn');
            const statusDiv = document.getElementById('status');
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            
            btn.disabled = true;
            btn.innerHTML = '‚è≥ –ê–Ω–∞–ª–∏–∑...';
            loading.style.display = 'block';
            results.style.display = 'none';
            
            statusDiv.className = 'status info';
            statusDiv.textContent = 'ü§ñ Claude –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ñ–æ—Ç–æ...';

            try {
                const base64 = await fileToBase64(selectedFile);
                
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': apiKey,
                        'anthropic-version': '2023-06-01',
                        'anthropic-dangerous-direct-browser-access': 'true'
                    },
                    body: JSON.stringify({
                        model: 'claude-3-5-sonnet-20241022',
                        max_tokens: 2000,
                        system: `–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ wellness –∏ –∞–Ω–∞–ª–∏–∑—É –∑–¥–æ—Ä–æ–≤—å—è –ø–æ —Ñ–æ—Ç–æ —è–∑—ã–∫–∞. 

–í–ê–ñ–ù–û: –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—å –Ω–∞ —Å–µ—Ä—å–µ–∑–Ω—ã–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏:
- –ë–µ–ª—ã–µ –ø—è—Ç–Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Å–º—ã–≤–∞—é—Ç—Å—è
- –ö—Ä–∞—Å–Ω—ã–µ/—Ç–µ–º–Ω—ã–µ –ø—è—Ç–Ω–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ñ–æ—Ä–º—ã
- –Ø–∑–≤—ã, —Ä–∞–Ω—ã
- –ê—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–µ –Ω–æ–≤–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è

–ï—Å–ª–∏ –µ—Å—Ç—å —Å–µ—Ä—å–µ–∑–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ - –¥–∞–π JSON:
{
  "urgent_medical_attention": true,
  "medical_alert": "–æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã",
  "concerning_features": ["—Å–ø–∏—Å–æ–∫ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤"],
  "recommendation": "–∫ –∫–∞–∫–æ–º—É –≤—Ä–∞—á—É –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è"
}

–ï—Å–ª–∏ —è–∑—ã–∫ –∑–¥–æ—Ä–æ–≤—ã–π - wellness –∞–Ω–∞–ª–∏–∑:
{
  "urgent_medical_attention": false,
  "detailed_analysis": "–¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —è–∑—ã–∫–∞",
  "zone_analysis": {"tip": "–∫–æ–Ω—á–∏–∫", "middle": "—Ü–µ–Ω—Ç—Ä", "edges": "–∫—Ä–∞—è", "back": "–∑–∞–¥–Ω—è—è —á–∞—Å—Ç—å"},
  "health_interpretation": "—á—Ç–æ –æ–∑–Ω–∞—á–∞—é—Ç –ø—Ä–∏–∑–Ω–∞–∫–∏ –¥–ª—è –∑–¥–æ—Ä–æ–≤—å—è",
  "wellness_recommendations": [{"product": "–Ω–∞–∑–≤–∞–Ω–∏–µ –ë–ê–î ABU", "reason": "–ø–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —ç—Ç–æ—Ç –ë–ê–î"}],
  "monitoring": "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É",
  "safety_note": "–≠—Ç–æ wellness –∞–Ω–∞–ª–∏–∑, –Ω–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞"
}`,
                        messages: [{
                            role: 'user',
                            content: [
                                {
                                    type: 'text',
                                    text: '–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —ç—Ç–æ —Ñ–æ—Ç–æ —è–∑—ã–∫–∞ –∏ –¥–∞–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ë–ê–î–æ–≤ ABU –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ.'
                                },
                                {
                                    type: 'image',
                                    source: {
                                        type: 'base64',
                                        media_type: 'image/jpeg',
                                        data: base64
                                    }
                                }
                            ]
                        }]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Claude API Error: ${response.status} - ${errorData.error?.message || 'Unknown error'}`);
                }

                const data = await response.json();
                const content = data.content[0].text;
                
                // –ò–∑–≤–ª–µ–∫–∞–µ–º JSON
                const jsonMatch = content.match(/\{[\s\S]*\}/);
                if (!jsonMatch) {
                    throw new Error('Claude –Ω–µ –≤–µ—Ä–Ω—É–ª JSON –æ—Ç–≤–µ—Ç');
                }

                const result = JSON.parse(jsonMatch[0]);
                displayResults(result);
                
                statusDiv.className = 'status success';
                statusDiv.textContent = '‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω!';
                
            } catch (error) {
                console.error('Error:', error);
                statusDiv.className = 'status error';
                statusDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
            }
            
            loading.style.display = 'none';
            btn.disabled = false;
            btn.innerHTML = 'ü§ñ –ê–Ω–∞–ª—ñ–∑ Claude';
        }

        function displayResults(data) {
            if (data.urgent_medical_attention) {
                document.getElementById('detailedAnalysis').innerHTML = `
                    <div style="background: #f8d7da; border: 3px solid #dc3545; padding: 20px; border-radius: 10px; color: #721c24;">
                        <h3>üö® –í–ù–ò–ú–ê–ù–ò–ï! –ù—É–∂–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –≤—Ä–∞—á–∞</h3>
                        <p><strong>${data.medical_alert}</strong></p>
                        <p><strong>–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–∏–∑–Ω–∞–∫–∏:</strong> ${data.concerning_features ? data.concerning_features.join(', ') : '–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è'}</p>
                        <p><strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong> ${data.recommendation}</p>
                        <p style="margin-top: 15px; font-weight: bold;">‚ö†Ô∏è –ë–ê–î—ã –ù–ï –ø–æ–¥—Ö–æ–¥—è—Ç. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –≤—Ä–∞—á—É!</p>
                    </div>
                `;
                
                document.getElementById('zoneAnalysis').innerHTML = '<p style="color: #666;">–ó–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–µ –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–∞—Ö</p>';
                document.getElementById('healthInterpretation').innerHTML = '<p style="color: #666;">–ù—É–∂–Ω–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</p>';
                document.getElementById('recommendations').innerHTML = '<p style="color: #666;">–ë–ê–î—ã –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é—Ç—Å—è. –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –≤—Ä–∞—á–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞.</p>';
                document.getElementById('monitoring').innerHTML = '<p style="color: #666;">–ó–∞–ø–∏—à–∏—Ç–µ—Å—å –∫ –≤—Ä–∞—á—É</p>';
                
            } else {
                document.getElementById('detailedAnalysis').innerHTML = `
                    <div style="background: #d4edda; border: 2px solid #28a745; padding: 15px; border-radius: 8px; color: #155724; margin-bottom: 15px;">
                        ‚úÖ –°–µ—Ä—å–µ–∑–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ
                    </div>
                    <p>${data.detailed_analysis}</p>
                `;

                if (data.zone_analysis) {
                    const zoneHtml = Object.entries(data.zone_analysis).map(([zone, analysis]) => {
                        const zoneNames = {
                            tip: 'üëÑ –ö–æ–Ω—á–∏–∫ —è–∑—ã–∫–∞',
                            middle: 'üçΩÔ∏è –°—Ä–µ–¥–Ω—è—è —á–∞—Å—Ç—å',
                            back: 'üè• –ó–∞–¥–Ω—è—è —á–∞—Å—Ç—å',
                            edges: 'üü° –ë–æ–∫–æ–≤—ã–µ –∫—Ä–∞—è'
                        };
                        
                        return `
                            <div class="zone-card">
                                <h4>${zoneNames[zone] || zone}</h4>
                                <p>${analysis}</p>
                            </div>
                        `;
                    }).join('');
                    document.getElementById('zoneAnalysis').innerHTML = zoneHtml;
                }

                document.getElementById('healthInterpretation').innerHTML = data.health_interpretation || '–°–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –Ω–æ—Ä–º–µ –¥–ª—è wellness –ø–æ–¥–¥–µ—Ä–∂–∫–∏';

                if (data.wellness_recommendations && data.wellness_recommendations.length > 0) {
                    const recommendationsHtml = data.wellness_recommendations.map(rec => `
                        <div class="recommendation">
                            <div class="product-name">üíä ${rec.product}</div>
                            <div class="product-details">
                                <strong>–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:</strong><br>
                                ${rec.reason}
                            </div>
                        </div>
                    `).join('');
                    document.getElementById('recommendations').innerHTML = recommendationsHtml;
                } else {
                    document.getElementById('recommendations').innerHTML = '<p>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã</p>';
                }

                document.getElementById('monitoring').innerHTML = `
                    <p><strong>‚ö†Ô∏è –í–∞–∂–Ω–æ:</strong> ${data.safety_note || '–≠—Ç–æ wellness –∞–Ω–∞–ª–∏–∑, –Ω–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞'}</p>
                    <p><strong>üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:</strong> ${data.monitoring || '–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è 2-3 –Ω–µ–¥–µ–ª–∏'}</p>
                `;
            }

            document.getElementById('results').style.display = 'block';
        }

        updateStatus();
    </script>
</body>
</html>

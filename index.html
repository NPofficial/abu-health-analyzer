<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABU Health Analyzer Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .api-setup {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 30px;
        }

        .api-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 14px;
        }

        .upload-area {
            border: 3px dashed #ddd;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            margin: 20px 30px;
            transition: all 0.3s;
        }

        .upload-area:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .preview-image {
            max-width: 400px;
            max-height: 400px;
            border-radius: 15px;
            margin: 20px auto;
            display: none;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .analyze-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 18px 50px;
            border-radius: 50px;
            font-size: 1.2em;
            cursor: pointer;
            margin: 20px auto;
            display: block;
            transition: all 0.3s;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .analyze-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .status {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 30px;
            text-align: center;
            font-weight: bold;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }

        .results {
            display: none;
            margin: 30px;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .analysis-section {
            background: #f8f9ff;
            border-left: 4px solid #667eea;
            padding: 25px;
            margin: 20px 0;
            border-radius: 10px;
        }

        .analysis-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .zone-analysis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .zone-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
        }

        .zone-card h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .recommendation {
            background: white;
            border: 2px solid #667eea;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            transition: all 0.3s;
        }

        .recommendation:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.15);
        }

        .product-name {
            color: #667eea;
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .product-details {
            background: #f0f4ff;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .target-zone {
            background: #e8f5e8;
            color: #28a745;
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-block;
            font-size: 0.9em;
            margin: 10px 0;
        }

        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî¨ ABU Health Analyzer Pro</h1>
            <p>–ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ –∑–¥–æ—Ä–æ–≤'—è –ø–æ —Ñ–æ—Ç–æ —è–∑–∏–∫–∞ –∑ –Ü–Ü Claude</p>
        </div>

        <div class="api-setup">
            <h4>üîë Claude API —á–µ—Ä–µ–∑ CORS –ø—Ä–æ–∫—Å–∏</h4>
            <p>–°–∏—Å—Ç–µ–º–∞ —Å–ø—Ä–æ–±—É—î –¥–µ–∫—ñ–ª—å–∫–∞ –ø—É–±–ª—ñ—á–Ω–∏—Ö –ø—Ä–æ–∫—Å–∏ –¥–ª—è –æ–±—Ö–æ–¥—É CORS:</p>
            <input type="password" id="apiKey" class="api-input" placeholder="sk-ant-api03-..." value="">
            <p><small>
            üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å–ø—Ä–æ–±—É—î 3 –ø—Ä–æ–∫—Å–∏ —Å–µ—Ä–≤–µ—Ä–∏<br>
            üí° –Ø–∫—â–æ –Ω–µ –ø—Ä–∞—Ü—é—î - <a href="https://cors-anywhere.herokuapp.com/corsdemo" target="_blank">–∞–∫—Ç–∏–≤—É–π—Ç–µ cors-anywhere</a><br>
            üîë API –∫–ª—é—á: <a href="https://console.anthropic.com/" target="_blank">console.anthropic.com</a>
            </small></p>
        </div>

        <div id="status" class="status info">
            –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ñ–æ—Ç–æ —è–∑–∏–∫–∞ –¥–ª—è –ø–æ—á–∞—Ç–∫—É –∞–Ω–∞–ª—ñ–∑—É
        </div>

        <div class="upload-area" onclick="document.getElementById('fileInput').click()">
            <div style="font-size: 3em; color: #ddd; margin-bottom: 10px;">üì∑</div>
            <h3>–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ñ–æ—Ç–æ —è–∑–∏–∫–∞</h3>
            <p>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –¥–ª—è –≤–∏–±–æ—Ä—É –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è (JPG, PNG)</p>
            <input type="file" id="fileInput" style="display: none;" accept="image/*">
        </div>

        <img id="previewImage" class="preview-image">
        
        <button id="analyzeBtn" class="analyze-btn" disabled onclick="analyzeImage()">
            ü§ñ –†–æ–∑—É–º–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ Claude AI
        </button>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <h3>ü§ñ Claude AI –∞–Ω–∞–ª—ñ–∑—É—î –≤–∞—à–µ —Ñ–æ—Ç–æ...</h3>
            <p>–ó–æ–Ω–∞–ª—å–Ω–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ç–∞ –ø—ñ–¥–±—ñ—Ä –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏—Ö –ë–ê–î—ñ–≤</p>
        </div>

        <div id="results" class="results">
            <div class="analysis-section">
                <h3>üîç –î–µ—Ç–∞–ª—å–Ω–∏–π –≤—ñ–∑—É–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑</h3>
                <div id="detailedAnalysis"></div>
            </div>

            <div class="analysis-section">
                <h3>üó∫Ô∏è –ó–æ–Ω–∞–ª—å–Ω–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h3>
                <div id="zoneAnalysis" class="zone-analysis"></div>
            </div>

            <div class="analysis-section">
                <h3>üéØ –Ü–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—è –∑–¥–æ—Ä–æ–≤'—è</h3>
                <div id="healthInterpretation"></div>
            </div>

            <div class="analysis-section">
                <h3>üíä –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó ABU</h3>
                <div id="recommendations"></div>
            </div>

            <div class="analysis-section">
                <h3>üìà –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–≥—Ä–µ—Å—É</h3>
                <div id="monitoring"></div>
            </div>
        </div>
    </div>

    <script>
        let selectedFile = null;
        let apiKey = '';

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.getElementById('apiKey').addEventListener('input', function(e) {
            apiKey = e.target.value.trim();
            updateStatus();
        });

        document.getElementById('fileInput').addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                selectedFile = e.target.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.getElementById('previewImage');
                    img.src = e.target.result;
                    img.style.display = 'block';
                    updateStatus();
                };
                reader.readAsDataURL(selectedFile);
            }
        });

        function updateStatus() {
            const statusDiv = document.getElementById('status');
            const analyzeBtn = document.getElementById('analyzeBtn');
            
            if (!apiKey) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå –ü–æ—Ç—Ä—ñ–±–µ–Ω Claude API –∫–ª—é—á –¥–ª—è —Ä–æ–±–æ—Ç–∏ —Å–∏—Å—Ç–µ–º–∏';
                analyzeBtn.disabled = true;
            } else if (!selectedFile) {
                statusDiv.className = 'status info';
                statusDiv.textContent = 'üì∑ API –∫–ª—é—á –∞–∫—Ç–∏–≤–Ω–∏–π. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ñ–æ—Ç–æ —è–∑–∏–∫–∞ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É';
                analyzeBtn.disabled = true;
            } else {
                statusDiv.className = 'status success';
                statusDiv.textContent = '‚úÖ –ì–æ—Ç–æ–≤–æ –¥–æ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É Claude AI!';
                analyzeBtn.disabled = false;
            }
        }

        // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // –ê–Ω–∞–ª–∏–∑ –¢–û–õ–¨–ö–û —Å Claude AI - –Ω–∏–∫–∞–∫–∏—Ö –¥–µ–º–æ —Ä–µ–∂–∏–º–æ–≤
        async function analyzeImage() {
            if (!selectedFile || !apiKey) {
                alert('–ü–æ—Ç—Ä—ñ–±–µ–Ω Claude API –∫–ª—é—á —Ç–∞ —Ñ–æ—Ç–æ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É');
                return;
            }
            
            const btn = document.getElementById('analyzeBtn');
            const statusDiv = document.getElementById('status');
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            
            btn.disabled = true;
            btn.innerHTML = '‚è≥ Claude AI –∞–Ω–∞–ª—ñ–∑—É—î...';
            loading.style.display = 'block';
            results.style.display = 'none';
            
            statusDiv.className = 'status info';
            statusDiv.textContent = 'ü§ñ Claude AI –ø—Ä–æ–≤–æ–¥–∏—Ç—å –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω—É –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫—É...';

            try {
                const result = await analyzeWithClaude();
                
                displayResults(result);
                statusDiv.className = 'status success';
                statusDiv.textContent = '‚úÖ –ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ Claude AI –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ!';
                
            } catch (error) {
                console.error('Claude AI error:', error);
                statusDiv.className = 'status error';
                statusDiv.textContent = `‚ùå –ü–æ–º–∏–ª–∫–∞ Claude AI: ${error.message}`;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                alert(`–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Claude AI:\n${error.message}\n\n–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ:\n1. –ü—Ä–∞–≤–∏–ª—å–Ω—ñ—Å—Ç—å API –∫–ª—é—á–∞\n2. –ë–∞–ª–∞–Ω—Å –Ω–∞ —Ä–∞—Ö—É–Ω–∫—É Anthropic\n3. –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç –∑'—î–¥–Ω–∞–Ω–Ω—è`);
            }
            
            loading.style.display = 'none';
            btn.disabled = false;
            btn.innerHTML = 'ü§ñ –ê–Ω–∞–ª—ñ–∑ Claude AI';
        }

        // –ü—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Ä–∞–±–æ—á–∏–µ CORS –ø—Ä–æ–∫—Å–∏
        async function analyzeWithClaude() {
            const base64 = await fileToBase64(selectedFile);
            
            const systemPrompt = `–¢–∏ - –ø–æ–º—ñ—á–Ω–∏–∫ –∑ wellness, —è–∫–∏–π –∞–Ω–∞–ª—ñ–∑—É—î —Ñ–æ—Ç–æ —è–∑–∏–∫–∞. –ö–†–ò–¢–ò–ß–ù–û –í–ê–ñ–õ–ò–í–û: —Ç–≤–æ—è –æ—Å–Ω–æ–≤–Ω–∞ –∑–∞–¥–∞—á–∞ - –≤–∏—è–≤–∏—Ç–∏ –æ–∑–Ω–∞–∫–∏, —â–æ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –ù–ï–ì–ê–ô–ù–û–á –º–µ–¥–∏—á–Ω–æ—ó –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó.

–ê–õ–ì–û–†–ò–¢–ú –ê–ù–ê–õ–Ü–ó–£:

1. –ü–ï–†–®–û–ß–ï–†–ì–û–í–û —à—É–∫–∞–π "–ß–ï–†–í–û–ù–Ü –ü–†–ê–ü–û–†–¶–Ü":

üö® –ù–ï–ì–ê–ô–ù–û –î–û –õ–Ü–ö–ê–†–Ø:
- –ë—ñ–ª—ñ –ø–ª—è–º–∏, —â–æ –Ω–µ –∑–º–∏–≤–∞—é—Ç—å—Å—è
- –ß–µ—Ä–≤–æ–Ω—ñ –∞–±–æ —Ç–µ–º–Ω—ñ –ø–ª—è–º–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó —Ñ–æ—Ä–º–∏  
- –Ø–∑–≤–∏, —Ä–∞–Ω–∏, –∫—Ä–æ–≤–æ—Ç–æ—á–∏–≤—ñ—Å—Ç—å
- –ê—Å–∏–º–µ—Ç—Ä–∏—á–Ω—ñ –Ω–æ–≤–æ—É—Ç–≤–æ—Ä–µ–Ω–Ω—è
- –í–∏—Ä–∞–∑–Ω–∏–π —Å—ñ—Ç—á–∞—Å—Ç–∏–π/—Ç—Ä—ñ—â–∏–Ω—É–≤–∞—Ç–∏–π –≤—ñ–∑–µ—Ä—É–Ω–æ–∫
- –ó–º—ñ–Ω–∞ –∫–æ–ª—å–æ—Ä—É –Ω–∞ —Ñ—ñ–æ–ª–µ—Ç–æ–≤–∏–π/—Å–∏–Ω—ñ–π/—á–æ—Ä–Ω–∏–π
- –ù–∞–±—Ä—è–∫–ª—ñ—Å—Ç—å –∑ –æ–¥–Ω–æ–≥–æ –±–æ–∫—É

üî∂ –ö–û–ù–°–£–õ–¨–¢–ê–¶–Ü–Ø –õ–Ü–ö–ê–†–Ø –†–ï–ö–û–ú–ï–ù–î–û–í–ê–ù–ê:
- –°—Ç—ñ–π–∫–∏–π –±—ñ–ª–∏–π –Ω–∞–ª—ñ—Ç >2 —Ç–∏–∂–Ω—ñ–≤
- –ó–±—ñ–ª—å—à–µ–Ω—ñ —Å–æ—Å–æ—á–∫–∏ –ø–æ –≤—Å—ñ–π –ø–æ–≤–µ—Ä—Ö–Ω—ñ
- –•—Ä–æ–Ω—ñ—á–Ω–∞ —Å—É—Ö—ñ—Å—Ç—å –∞–±–æ –Ω–∞–¥–º—ñ—Ä–Ω–∞ –≤–æ–ª–æ–≥—ñ—Å—Ç—å

‚úÖ –ú–û–ñ–ù–ê WELLNESS –†–ï–ö–û–ú–ï–ù–î–ê–¶–Ü–á:
- –õ–µ–≥–∫–∏–π –±—ñ–ª–∏–π –Ω–∞–ª—ñ—Ç —É —Ü–µ–Ω—Ç—Ä—ñ
- –ù–µ–∑–Ω–∞—á–Ω—ñ –≤—ñ–¥–±–∏—Ç–∫–∏ –∑—É–±—ñ–≤ –ø–æ –∫—Ä–∞—è—Ö
- –ù–æ—Ä–º–∞–ª—å–Ω–∏–π —Ä–æ–∂–µ–≤–∏–π –∫–æ–ª—ñ—Ä

2. –Ø–ö–©–û –í–ò–Ø–í–õ–ï–ù–Ü "–ß–ï–†–í–û–ù–Ü –ü–†–ê–ü–û–†–¶–Ü" - –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–π —Ç—ñ–ª—å–∫–∏ JSON –∑ medical_alert
3. –¢–Ü–õ–¨–ö–ò —è–∫—â–æ –±–µ–∑–ø–µ—á–Ω–æ - wellness –∞–Ω–∞–ª—ñ–∑ –∑ –ë–ê–î–∞–º–∏ ABU`;

            const requestBody = {
                model: 'claude-3-sonnet-20240229',
                max_tokens: 2000,
                system: systemPrompt,
                messages: [{
                    role: 'user',
                    content: [
                        {
                            type: 'text',
                            text: `–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π —Ü–µ —Ñ–æ—Ç–æ —è–∑–∏–∫–∞ –∑–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º –±–µ–∑–ø–µ–∫–∏. –°–ü–û–ß–ê–¢–ö–£ –ø–µ—Ä–µ–≤—ñ—Ä –Ω–∞ "–ß–ï–†–í–û–ù–Ü –ü–†–ê–ü–û–†–¶–Ü".

–Ø–∫—â–æ —î –Ω–µ–±–µ–∑–ø–µ—á–Ω—ñ –æ–∑–Ω–∞–∫–∏ - –¥–∞–π JSON:
{
  "urgent_medical_attention": true,
  "medical_alert": "–æ–ø–∏—Å –ø—Ä–æ–±–ª–µ–º–∏",
  "concerning_features": ["—Å–ø–∏—Å–æ–∫ –æ–∑–Ω–∞–∫"],
  "recommendation": "–¥–æ —è–∫–æ–≥–æ –ª—ñ–∫–∞—Ä—è –∑–≤–µ—Ä—Ç–∞—Ç–∏—Å—å"
}

–Ø–∫—â–æ —è–∑–∏–∫ –±–µ–∑–ø–µ—á–Ω–∏–π - wellness –∞–Ω–∞–ª—ñ–∑:
{
  "urgent_medical_attention": false,
  "detailed_analysis": "–æ–ø–∏—Å",
  "zone_analysis": {"tip": "–∫–æ–Ω—á–∏–∫", "middle": "—Ü–µ–Ω—Ç—Ä", "edges": "–∫—Ä–∞—ó"},
  "wellness_recommendations": [{"product": "–ë–ê–î ABU", "reason": "—á–æ–º—É"}],
  "safety_note": "–¶–µ wellness –∞–Ω–∞–ª—ñ–∑, –Ω–µ –º–µ–¥–∏—á–Ω–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞"
}`
                        },
                        {
                            type: 'image',
                            source: {
                                type: 'base64',
                                media_type: 'image/jpeg',
                                data: base64
                            }
                        }
                    ]
                }]
            };

            // –†–∞–±–æ—á–∏–µ –ø—É–±–ª–∏—á–Ω—ã–µ –ø—Ä–æ–∫—Å–∏
            const workingProxies = [
                {
                    url: 'https://api.allorigins.win/raw?url=' + encodeURIComponent('https://api.anthropic.com/v1/messages'),
                    method: 'POST'
                },
                {
                    url: 'https://cors-anywhere.herokuapp.com/https://api.anthropic.com/v1/messages',
                    method: 'POST'
                },
                {
                    url: 'https://proxy.cors.sh/https://api.anthropic.com/v1/messages',
                    method: 'POST'
                }
            ];

            let lastError;

            for (let i = 0; i < workingProxies.length; i++) {
                const proxy = workingProxies[i];
                console.log(`üîÑ –°–ø—Ä–æ–±–∞ ${i + 1}: ${proxy.url.split('/')[2]}`);

                try {
                    const response = await fetch(proxy.url, {
                        method: proxy.method,
                        headers: {
                            'Content-Type': 'application/json',
                            'x-api-key': apiKey,
                            'anthropic-version': '2023-06-01',
                            'anthropic-dangerous-direct-browser-access': 'true', // –¢—Ä–µ–±—É–µ–º—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
                            'Origin': window.location.origin
                        },
                        body: JSON.stringify(requestBody)
                    });

                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`${response.status}: ${errorText.substring(0, 200)}`);
                    }

                    const data = await response.json();
                    
                    if (!data.content || !data.content[0] || !data.content[0].text) {
                        throw new Error('–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤—ñ–¥ Claude');
                    }

                    const content = data.content[0].text;
                    console.log(`‚úÖ –£—Å–ø—ñ—Ö —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ ${i + 1}`);
                    
                    // –ò–∑–≤–ª–µ–∫–∞–µ–º JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞
                    const jsonMatch = content.match(/\{[\s\S]*\}/);
                    if (!jsonMatch) {
                        throw new Error('Claude –Ω–µ –ø–æ–≤–µ—Ä–Ω—É–≤ JSON –≤—ñ–¥–ø–æ–≤—ñ–¥—å');
                    }

                    return JSON.parse(jsonMatch[0]);

                } catch (error) {
                    console.log(`‚ùå –ü—Ä–æ–∫—Å–∏ ${i + 1} –Ω–µ –ø—Ä–∞—Ü—é—î:`, error.message);
                    lastError = error;
                    
                    // –ï—Å–ª–∏ —ç—Ç–æ cors-anywhere, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
                    if (proxy.url.includes('cors-anywhere') && error.message.includes('403')) {
                        console.log('üí° –î–ª—è cors-anywhere –ø–æ—Ç—Ä—ñ–±–Ω–æ –∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏: https://cors-anywhere.herokuapp.com/corsdemo');
                    }
                    
                    continue;
                }
            }

            // –ï—Å–ª–∏ –≤—Å–µ –ø—Ä–æ–∫—Å–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏
            throw new Error(`–í—Å—ñ CORS –ø—Ä–æ–∫—Å–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ. 

–ú–æ–∂–ª–∏–≤—ñ —Ä—ñ—à–µ–Ω–Ω—è:
1. –ê–∫—Ç–∏–≤—É–π—Ç–µ cors-anywhere: https://cors-anywhere.herokuapp.com/corsdemo
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ API –∫–ª—é—á Claude
3. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ
4. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ VPN

–û—Å—Ç–∞–Ω–Ω—è –ø–æ–º–∏–ª–∫–∞: ${lastError.message}`);
        }

        // –£–¥–∞–ª—è–µ–º –≤—Å–µ –¥–µ–º–æ —Ñ—É–Ω–∫—Ü–∏–∏ - –∏—Ö –±–æ–ª—å—à–µ –Ω–µ—Ç
        
        // –î–µ–º–æ –∞–Ω–∞–ª–∏–∑
        function getDemoAnalysis() {
            // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
            return null;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
        function displayResults(data) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
            if (data.urgent_medical_attention) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
                document.getElementById('detailedAnalysis').innerHTML = `
                    <div style="background: #f8d7da; border: 3px solid #dc3545; padding: 20px; border-radius: 10px; color: #721c24;">
                        <h3>üö® –£–í–ê–ì–ê! –ü–æ—Ç—Ä—ñ–±–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è –ª—ñ–∫–∞—Ä—è</h3>
                        <p><strong>${data.medical_alert}</strong></p>
                        <p><strong>–í–∏—è–≤–ª–µ–Ω—ñ –æ–∑–Ω–∞–∫–∏:</strong> ${data.concerning_features ? data.concerning_features.join(', ') : '–ü—ñ–¥–æ–∑—Ä—ñ–ª—ñ –∑–º—ñ–Ω–∏'}</p>
                        <p><strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:</strong> ${data.recommendation}</p>
                        <p style="margin-top: 15px; font-weight: bold;">‚ö†Ô∏è –ë–ê–î–∏ –ù–ï –ø—ñ–¥—Ö–æ–¥—è—Ç—å –≤ —Ü—ñ–π —Å–∏—Ç—É–∞—Ü—ñ—ó. –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –ª—ñ–∫–∞—Ä—è —è–∫–Ω–∞–π—à–≤–∏–¥—à–µ!</p>
                    </div>
                `;
                
                // –°–∫—Ä—ã–≤–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–µ–∫—Ü–∏–∏
                document.getElementById('zoneAnalysis').innerHTML = '<p style="color: #666;">–ó–æ–Ω–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ –Ω–µ –ø—Ä–æ–≤–æ–¥–∏—Ç—å—Å—è –ø—Ä–∏ –≤–∏—è–≤–ª–µ–Ω–Ω—ñ –ø—Ä–æ–±–ª–µ–º–Ω–∏—Ö –æ–∑–Ω–∞–∫</p>';
                document.getElementById('healthInterpretation').innerHTML = '<p style="color: #666;">–ü–æ—Ç—Ä—ñ–±–Ω–∞ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∞ –º–µ–¥–∏—á–Ω–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</p>';
                document.getElementById('recommendations').innerHTML = '<p style="color: #666;">–ë–ê–î–∏ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é—Ç—å—Å—è. –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è –ª—ñ–∫–∞—Ä—è –æ–±–æ–≤\'—è–∑–∫–æ–≤–∞.</p>';
                document.getElementById('monitoring').innerHTML = '<p style="color: #666;">–ó–∞–ø–∏—à—ñ—Ç—å—Å—è –Ω–∞ –ø—Ä–∏–π–æ–º –¥–æ –ª—ñ–∫–∞—Ä—è</p>';
                
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—ã—á–Ω—ã–π wellness –∞–Ω–∞–ª–∏–∑
                document.getElementById('detailedAnalysis').innerHTML = `
                    <div style="background: #d4edda; border: 2px solid #28a745; padding: 15px; border-radius: 8px; color: #155724; margin-bottom: 15px;">
                        ‚úÖ –ù–µ –≤–∏—è–≤–ª–µ–Ω–æ —Å–µ—Ä–π–æ–∑–Ω–∏—Ö –æ–∑–Ω–∞–∫, —â–æ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –Ω–µ–≥–∞–π–Ω–æ—ó –º–µ–¥–∏—á–Ω–æ—ó –¥–æ–ø–æ–º–æ–≥–∏
                    </div>
                    ${data.detailed_analysis}
                `;

                // –ó–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
                if (data.zone_analysis) {
                    const zoneHtml = Object.entries(data.zone_analysis).map(([zone, analysis]) => {
                        const zoneNames = {
                            tip: 'üëÑ –ö–æ–Ω—á–∏–∫ —è–∑–∏–∫–∞',
                            front: 'ü´Å –ü–µ—Ä–µ–¥–Ω—è —á–∞—Å—Ç–∏–Ω–∞', 
                            middle: 'üçΩÔ∏è –°–µ—Ä–µ–¥–Ω—è —á–∞—Å—Ç–∏–Ω–∞',
                            back: 'üè• –ó–∞–¥–Ω—è —á–∞—Å—Ç–∏–Ω–∞',
                            edges: 'üü° –ë–æ–∫–æ–≤—ñ –∫—Ä–∞—ó'
                        };
                        
                        return `
                            <div class="zone-card">
                                <h4>${zoneNames[zone] || zone}</h4>
                                <p>${analysis}</p>
                            </div>
                        `;
                    }).join('');
                    document.getElementById('zoneAnalysis').innerHTML = zoneHtml;
                }

                document.getElementById('healthInterpretation').innerHTML = data.health_interpretation || '–ó–∞–≥–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω –≤ –º–µ–∂–∞—Ö –Ω–æ—Ä–º–∏ –¥–ª—è wellness –ø—ñ–¥—Ç—Ä–∏–º–∫–∏';

                // –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
                if (data.wellness_recommendations && data.wellness_recommendations.length > 0) {
                    const recommendationsHtml = data.wellness_recommendations.map(rec => `
                        <div class="recommendation">
                            <div class="product-name">üíä ${rec.product}</div>
                            <div class="product-details">
                                <strong>–û–±“ë—Ä—É–Ω—Ç—É–≤–∞–Ω–Ω—è:</strong><br>
                                ${rec.reason}
                            </div>
                            ${rec.expected_effect ? `
                                <div class="product-details">
                                    <strong>–û—á—ñ–∫—É–≤–∞–Ω–∏–π –µ—Ñ–µ–∫—Ç:</strong><br>
                                    ${rec.expected_effect}
                                </div>
                            ` : ''}
                        </div>
                    `).join('');
                    document.getElementById('recommendations').innerHTML = recommendationsHtml;
                } else {
                    document.getElementById('recommendations').innerHTML = '<p>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –Ω–µ –Ω–∞–¥–∞–Ω—ñ</p>';
                }

                document.getElementById('monitoring').innerHTML = `
                    <p><strong>‚ö†Ô∏è –í–∞–∂–ª–∏–≤–æ:</strong> ${data.safety_note || '–¶–µ wellness –∞–Ω–∞–ª—ñ–∑, –Ω–µ –º–µ–¥–∏—á–Ω–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞. –ü—Ä–∏ –ø–æ–≥—ñ—Ä—à–µ–Ω–Ω—ñ —Å—Ç–∞–Ω—É - –æ–±–æ–≤\'—è–∑–∫–æ–≤–æ –∑–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –ª—ñ–∫–∞—Ä—è!'}</p>
                    <p><strong>üìä –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥:</strong> ${data.monitoring || '–í—ñ–¥—Å—Ç–µ–∂—É–π—Ç–µ –∑–º—ñ–Ω–∏ –ø—Ä–æ—Ç—è–≥–æ–º 2-3 —Ç–∏–∂–Ω—ñ–≤'}</p>
                `;
            }

            document.getElementById('results').style.display = 'block';
        }
    </script>
</body>
</html>
